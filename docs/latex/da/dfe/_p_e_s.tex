C\+DE can call several external programs to obtain energies and forces on atoms during G\+DS and N\+EB runs. This section describes how this is managed, and how input files can be set-\/up to run different external codes.\hypertarget{_p_e_s_autotoc_md7}{}\doxysection{P\+E\+S types}\label{_p_e_s_autotoc_md7}

\begin{DoxyItemize}
\item The potential energy surface (P\+ES) type to be used during a C\+D\+E-\/based calculation is indicated through the variables {\bfseries{pestype}} and {\bfseries{pesopttype}}.
\item The {\bfseries{pestype}} is used whenever the code requires a single-\/point energy evaluation.
\item The current allowed values of {\bfseries{pestype}} are (see pes.\+f90)\+:
\begin{DoxyItemize}
\item {\itshape orca}\+: Performs a calculation using the quantum chemical program O\+R\+CA (\href{https://orcaforum.cec.mpg.de}{\texttt{ https\+://orcaforum.\+cec.\+mpg.\+de}})
\item {\itshape dftb}\+: Performs a calculation using the density-\/functional tight-\/binding code D\+F\+T\+B+ (\href{https://www.dftbplus.org}{\texttt{ https\+://www.\+dftbplus.\+org}})
\item {\itshape psi4}\+: Performs a calculation using the psi-\/4 quantum code (\href{http://www.psicode.org}{\texttt{ http\+://www.\+psicode.\+org}})
\item {\itshape lammps}\+: Performs a calculation of the P\+ES using the L\+A\+M\+M\+PS simulation package (\href{https://lammps.sandia.gov}{\texttt{ https\+://lammps.\+sandia.\+gov}})
\item {\itshape null}\+: Does not perform a P\+ES evaluation. Simply returns V = 0 and forces(\+:) = 0 for all atoms.
\end{DoxyItemize}
\item The {\bfseries{pesopttype}} is used whenever the code requires a geometry optimization.
\item The allowed values of {\bfseries{pesopttype}} are\+:
\begin{DoxyItemize}
\item {\itshape orca}\+: O\+R\+CA calculation.
\item {\itshape dftb}\+: D\+F\+T\+B+ calculation.
\item {\itshape psi4}\+: Psi-\/4 calculation.
\item {\itshape lammps}\+: L\+A\+M\+M\+PS calculation.
\item {\itshape uff}\+: Performs geometry optimization under the U\+FF (Universal force-\/field) as implemented in babel/openbabel (\href{http://openbabel.org/wiki/Main_Page}{\texttt{ http\+://openbabel.\+org/wiki/\+Main\+\_\+\+Page}})
\item {\itshape null}\+: Does not perform geometry optimization.
\end{DoxyItemize}
\item To add new P\+ES evaluation types, you need to edit the files pes.\+f90 and io.\+f90; {\bfseries{DO N\+OT DO T\+H\+IS U\+N\+L\+E\+SS Y\+OU A\+RE S\+U\+RE Y\+OU K\+N\+OW W\+H\+AT Y\+OU A\+RE D\+O\+I\+N\+G!}}
\end{DoxyItemize}\hypertarget{_p_e_s_autotoc_md8}{}\doxysection{P\+E\+S and geometry optimization executables}\label{_p_e_s_autotoc_md8}
As well as knowing which type of P\+ES calculation you\textquotesingle{}d like, the C\+DE code needs to know {\itshape how} to run the external executables which are requested to calculate potential energies and forces, or to run geometry optimizations.

The executables to be used to energy evaluations or geometry optimization are defined in the variables {\itshape pesexecutable} and {\itshape pesoptexecutable}, as follows\+: \begin{DoxyVerb}pesexecutable ~/programs/orca
pesoptexecutable ~/programs/orca
\end{DoxyVerb}


In the example above, we\textquotesingle{}re are indicating that the external program to be used is {\itshape orca}, and this is stored in the directory $\ast$$\sim$/programs/$\ast$.

Internally, C\+DE runs F\+O\+R\+T\+R\+AN {\itshape E\+X\+E\+C\+U\+T\+E\+\_\+\+C\+O\+M\+M\+A\+N\+D\+\_\+\+L\+I\+NE} calls to run external codes, using input files generated according to templates provided as {\itshape pesfile} and {\itshape pesoptfile} (see below).

For example, based on the above, C\+DE will run the following command when an {\itshape O\+R\+CA} calculation is required\+: \begin{DoxyVerb}~/programs/orca temp.in
\end{DoxyVerb}


where {\itshape temp.\+in} is the name of a temporary input file which is auto-\/generated by C\+DE during N\+EB calculations.

{\bfseries{If there is no executable called \char`\"{}$\sim$/programs/orca\char`\"{}, the C\+DE calculation will fail!}}

To make sure everything runs smoothly, there are two useful options\+:

(1) You can set up an alias for each executable, then provide the alias as {\itshape pesexecutable} and {\itshape pesoptexecutable}. For example, lets say you have {\itshape O\+R\+CA} installed in $\ast$$\sim$/programs/stuff/orca/bin/$\ast$. If you include an alias in your $\ast$.bashrc$\ast$ (or similar config file if you\textquotesingle{}re on a different system) which reads \begin{DoxyVerb}alias orca='~/programs/stuff/orca/bin/orca'
\end{DoxyVerb}


then running the command {\itshape orca} will then execute $\ast$$\sim$/programs/stuff/orca/bin/orca$\ast$, which should indeed correspond to an executable binary.

This means that you can then use the following in your C\+DE input files\+:

\begin{DoxyVerb}pesexecutable orca
pesoptexecutable orca
\end{DoxyVerb}


without having to provide the full path to the executables.

(2) As an alternative, you can also give the full pathname to the desired executable directly in the input file, lik this\+: \begin{DoxyVerb}  pesexecutable ~/programs/stuff/orca/bin/orca
  pesoptexecutable ~/programs/stuff/orca/bin/orca
\end{DoxyVerb}
\hypertarget{_p_e_s_autotoc_md9}{}\doxysection{P\+E\+S template files}\label{_p_e_s_autotoc_md9}

\begin{DoxyItemize}
\item The final pieces of information which C\+DE requires in order to perform energy evaluations or geometry optimization is a P\+ES {\itshape template file}.
\item The input parameters {\bfseries{pesfile}} and {\bfseries{pesoptfile}} are header files which are used to direct external codes which calculation to perform when they are called by C\+DE. These header files must have the same format as input files required by the {\itshape pesexecutable} and {\itshape pesoptexecutable}.
\item The only difference is that there must be a line with {\itshape X\+XX} as follows\+:
\end{DoxyItemize}

\begin{DoxyVerb}    XXX
\end{DoxyVerb}



\begin{DoxyItemize}
\item The {\itshape X\+XX} tells the C\+DE code where it should insert the coordinates of the configuration at which the energy evaluation is requested. After inserting the coordinates, C\+DE writes the input file then runs the relevant external executable to evaluate the energy. Once the energy evaluation (or geometry optimization) is complete, C\+DE reads in the results.
\item The file pes.\+f90 can be consulted to see how this write/run/read process works for each external code.
\item An example header file for a P\+ES evaluation by O\+R\+CA using P\+M3 semi-\/empirical method might be as follows\+:
\end{DoxyItemize}

\begin{DoxyVerb}! PM3
* xyz 0 1
XXX
*
\end{DoxyVerb}



\begin{DoxyItemize}
\item An example header file for P\+ES evaluation by D\+F\+T\+B+ might be as follows\+:
\end{DoxyItemize}

\begin{DoxyVerb} Geometry = GenFormat {
XXX
}
Driver = {}
 Hamiltonian = DFTB {
 SCC = Yes
 SCCTolerance = 1e-3
 Mixer = Broyden{}
 Eigensolver = RelativelyRobust {}
MaxAngularMomentum {
 C = "p"
O = "p"
H = "s"
 }
SlaterKosterFiles = Type2FileNames {
Prefix = "/Users/scott/code/cde/src/SKfiles/"
 Separator = "-"
 Suffix = ".skf"
 }
}
Analysis = {
CalculateForces = Yes
 }
\end{DoxyVerb}



\begin{DoxyItemize}
\item Note in the above examples that the only part of the file which is written by C\+DE is in replacing the {\itshape X\+XX} with the coordinates at which the energy evaluation is being performed. All other aspects, such as the calculation type (e.\+g. D\+FT, Hartree-\/\+Fock, semi-\/empirical, D\+F\+T\+B+), basis sets, accuracy, and so on, are controlled by editing the {\itshape pesfile} and {\itshape pesoptfile} B\+E\+F\+O\+RE the calculation starts. 
\end{DoxyItemize}