<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CDE: Tutorial 4: Unguided graph-driven sampling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CDE
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Chemistry Discovery Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_tutorial4.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tutorial 4: Unguided graph-driven sampling </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial gives example input files and instructions for a typical unguided graph-driven sampling (GDS) calculation run through CDE.</p>
<p>In this case, we are going to run a GDS simulation for the 4-atom formaldehyde system. The aim of these simulations is to stochastically generate a large set of reactions (using the allowed move classes in the <em>movefile</em>). After generation of a set of reactions, further analysis such as NEB or GraphGen can be used to study the reaction network.</p>
<p>Ultimately, one might also perform reaction rate calculations and use the rates as input to a microkinetic modelling simulation; connecting CDE to a kinetics modelling code is a work in progress (<a class="el" href="todo.html">Things to do</a>).</p>
<p><b>The actual files to run this example can be found in the *~/cde/examples/Tutorial_4/* directory.</b></p>
<p>In this directory, you will find several input files: </p><pre class="fragment">input
start.xyz
end.xyz
moves.in
</pre><p>All of these input filenames are arbitrary; we could have called them alice, bob, clive and ralph and the program would still read them in correctly. Note that the extensions have no effect for input files read in by CDE, but they can be used to remind you what the different input files are.</p>
<p>Let's have a look at each input file individually:</p>
<h2><a class="anchor" id="autotoc_md32"></a>
input</h2>
<p>The <em>input</em> file for this GDS run looks like this: </p><pre class="fragment"># Control parameters

nimage 8
temperature 10
calctype gds
startfile start.xyz
endfile end.xyz
ranseed  1
startfrompath   .FALSE.
pathinit  linear

# constraints

dofconstraints 3
1 2 3

# PES input

pestype  null
pesopttype  null

# GDS control

movefile moves.in
gdsthresh 0.1
gdsspring 0.05
gdsrestspring 0.05
nbstrength 0.05
nbrange 2.3
kradius 0.1
gdstemperature 100
gdscoefftemp 100
gdscoeffmass 50000
timestep 0.5
ngdsiter 200
ngdsrelax 2000
gdsdtrelax 0.1

valencerange{
C 1 4
O 1 2
H 0 1
}

reactiveatomtypes{
C
O
H
}

reactiveatoms{
range 1 4
}
</pre><p>The input file in this case only contains those options which are relevant to the GDS simulation; other input directives have been removed and will be ignored internally in CDE.</p>
<p>The first input block (beginning with the comment line "# control parameters") identifies the following input parameters:</p><ul>
<li><b>nimage</b>: Number of images (in total) in the reaction-path which is going to be used to sample reaction-space. In this case, we have 8.</li>
<li><b>temperature</b>: The reaction-string in GDS is dynamic; as well as sampling paths between different reaction end-points, it samples different conformations along the path using molecular dynamics. The <em>temperature</em> parameter is used to control the velocities of each atom in the string; these velocities are drawn from a Boltzmann distribution at the input <em>temperature</em> (in Kelvin).</li>
</ul>
<p><b>IMPORTANT: If the <em>pestype</em> is set to null (as it is in this example), the GDS reaction-string is not really dynamic anymore, and we instead simply generate reaction paths connecting sampled reactants and products using interpolation (rather than molecular dynamics).</b></p>
<ul>
<li><b>calctype</b>: Here, we're using <em>gds</em> to indicate that we want to do a GDS calculation.</li>
<li><b>startfile</b>: This is an XYZ format file (with Cartesian coordinates in Angstroms) which contains the coordinates of the start-point of the initial reaction-string.</li>
<li><b>endfile</b>: Like the <em>startfile</em>, the <em>endfile</em> is an XYZ file which contains the coordinates of the end-point of the initial reaction-string. This file must contain the same number of atoms, as well as the same atomic label order, as the <em>startfile</em>.</li>
</ul>
<p><b>Note that the <em>startfile</em> and the <em>endfile</em> can be identical; after starting with this "zero-string", the natural evolution of GDS will quickly start generating new reaction-paths.</b></p>
<ul>
<li><b>ranseed</b>: This is an integer random number seed, used to generate random initial velocities drawn from the Boltzmann distribution for GDS sampling (see above).</li>
<li><b>startfrompath</b>: Here, by inputting ".FALSE.", we're indicating that CDE should generate the initial reaction-path by interpolating between the <em>startfile</em> adn the <em>endfile</em>.</li>
<li><b>pathinit</b>: This defines the interpolation type which is used to generate the initial reaction-path between the <em>startfile</em> and <em>endfile</em>. The current option indicates that a simple linear interpolation of coordinates will be used.</li>
</ul>
<p>The next input block (starting with "# constraints") indicate any constraints we'd like to impose on each image in the reaction-path during NEB optimization.</p>
<ul>
<li><b>dofconstraints</b>: In this example, we've indicated that there are 3 DOF constraints, namely on the (x,y,z) corodinates of atom 1. This particular constraint prevents overall translation of the chemical system. Note that the constraints are applied to all images along the reaction-path.</li>
</ul>
<p>The next block (starting with "# PES input") defines options to enable potential energy evaluations and geometry optimization during the NEB calculation. These input parameters are discussed elsewhere, such as in <a class="el" href="_p_e_s.html">PES evaluations</a>.</p>
<p>However, it is worth noting the particular example given here; specifically, we indicate: </p><pre class="fragment">pestype  null
pesopttype  null
</pre><p>The <em>null</em> entries indicate that NO potential energy function is used during path sampling. Instead, reaction-paths are generated using an algorithm based on the following steps:</p>
<p>(1) Optimization of newly-generated reaction end-points under the graph-enforcing potential.</p>
<p>(2) [OPTIONAL] Further optimization of end-points under a potential (see below).</p>
<p>(3) Simple linear interpolation of the reaction-path between the end-points.</p>
<p>(4) Optimization of the reaction-path under a repulsive potential function to avoid close-contacts.</p>
<p>This *"zero-potential"* graph-sampling method is very fast, but can generate reaction-paths which are somewhat further away from the minimum-ewnergy paths than if an actual potential energy function is used.</p>
<p>The next input block ("# GDS control") contains parameters relating to the GDS sampling. The input variables are as follows:</p>
<ul>
<li><b>movefile</b>: This defines the file containing the list of allowed graph-moves. See the section <a class="el" href="moves.html">Movefile example</a> for further details on the format of this file.</li>
<li><b>gdsthresh</b>: During each iteration of the GDS run, <em>gdsthresh</em> is the probability that a new graph-move will be attempted (not necessarily accepted).</li>
<li><b>gdsspring</b>: This is the GDS spring constant for the potential energy term acting between adjacent beads (in atomic units, Eh/Bohr^2).</li>
<li><b>gdsrestspring</b>:: This is the force constant for the GDS graph-enforcing potential (in atomic units, Eh/bohr^2).</li>
<li><b>nbstrength</b>: The pre-factor (or strength) for the repulsive term in the GDS graph-enforcing potential (in atomic units, Eh).</li>
<li><b>nbrange</b>: The range parameter for the repulsive term in the GDS graph-enforcing potential. Typical values are between 2 and 3 Bohr (input is in atomic units, Bohr).</li>
<li><b>kradius</b>: This defines the strength of the interaction potential term which ensures that distinct molecules remain a minimum distance apart (in atomic units, Eh).</li>
<li><b>gdstemperature</b>: In the original GDS scheme, the reaction-string itself is dynamic. The input parameter <em>gdstemperature</em> defines the temperature (in K) for the Boltzmann distribution which is sampled to generate initial momenta for reaction-string end-points.</li>
<li><b>gdscoefftemp</b>: This parameter defines the temperature (in K) of the Boltzmann distribution which is sampled to generate artificial momenta for the Fourier coefficients which define the dynamic reaction-string in GDS.</li>
<li><b>gdscoeffmass</b>: This is the effective mass of the Fourier coefficients which define the reaction-string (in atomic units, typical value: 50000)</li>
<li><b>timestep</b>: This is the time-step (in fs) for MD propagation of the reaction-string during GDS.</li>
<li><b>ngdsiter</b>: Number of iterations (or time-steps) in GDS simulation.</li>
<li><b>ngdsrelax</b>: After each graph-move, we re-optimize the atomic coordinates of the moved end-point under the action of the graph-enforcing potential. This is achieved using a simple steepest descent algorithm running for <em>ngdsrelax</em> steps.</li>
<li><b>gdsdtrelax</b>: In the steepest descent calculation mentioned above, *gdsdtrelax** is the effective time-step which is taken during optimization (in au, typical valu 0.1).</li>
</ul>
<p>The remaining section of the input file, contains the following entries: </p><pre class="fragment">valencerange{
C 1 4
O 1 2
H 0 1
}

reactiveatomtypes{
C
O
H
}

reactiveatoms{
range 1 4
}
</pre><p>These directives are described in more detail in <a class="el" href="_annotated.html">Annotated input file description</a>. In general, they define which atoms are allowed to react (<em>reactiveatomtypes</em>), the allowed valence ranges of the atoms (<em>valencerange</em>), and the indices of the reactive atoms (<em>reactiveatoms</em>).</p>
<p>In the example given above:</p>
<ul>
<li>Carbon can bond to between 1 and 4 other atoms, oxygen can bond to 1 or 2 other atoms and hydrogen can bond to 0 or 1 other atoms.</li>
<li>All atom types in this system (Co,O and H) can participate in reactions.</li>
<li>All 4 atoms in the system can participate in reactions, as identified by the <em>range 1 4</em> entry under <em>reactiveatoms</em>.</li>
</ul>
<p>Note that there is some redundancy here, but the ability to define reactivity in different ways allows flexibility in applications.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
start.xyz and end.xyz</h2>
<p>The <em>start.xyz</em> and <em>end.xyz</em> files are standard XYZ format files (Cartesian coordinates in Angstroms). For example, in the current example, the <em>start.xyz</em> file looks like this:</p>
<pre class="fragment">4
starting point
C       0.0  0.0  0.0
O      -1.30  0.0  0.0
H      0.5  0.866  0.0
H      0.5 -0.866 0.0
</pre><p>The <em>start.xyz</em> and <em>end.xyz</em> files are used to generate the initial reaction-string for GDS sampling.</p>
<p>During GDS, new reactions and reaction-strings are quickly generated. So, even if you start with the <em>start.xyz</em> and <em>end.xyz</em> files being the same, your GDS run will very quickly generate new reaction-paths.</p>
<p>If <em>start.xyz</em> and <em>end.xyz</em> are different, the code will try to generate an initial reaction-string by linear interpolation between the two end-points if the variable <em>pathinit</em> is set to <em>linear</em>. (Note that, in the current version of the code, the only option to <em>pathinit</em> is <em>linear</em>).</p>
<h2><a class="anchor" id="autotoc_md34"></a>
moves.in</h2>
<p>The moves.in file describes the allowed chemical reaction classes which are allowed to take place; these allowed moves are applied to configurations during a GDS calculation in order to generate new reaction end-points.</p>
<p>The format of the move-file is discussed in <a class="el" href="moves.html">Movefile example</a>.</p>
<h2><a class="anchor" id="autotoc_md35"></a>
Running the calculation</h2>
<p>With these input files, we are now able to run the GDS calculation. To do so, go into the *~/cde/examples/gds/* directory and type: </p><pre class="fragment">cde.x input
</pre><p>The above assumes that you have already made sure that CDE can be run by simply typing <em>cde.x</em>. See the <a class="el" href="setup.html">setup section</a> for more details.</p>
<p>As the calculation runs, you will find lots of output files generated in the run directory.</p>
<p>The interesting output files are as follows:</p>
<ul>
<li><b>initial_path.xyz</b>: This file contains the initial reaction-string generated by CDE using the <em>start.xyz</em> and <em>end.xyz</em> files.</li>
<li><b>input.nebprofile</b>: This file contains the energy profile along the reaction-string at the different iterations of the NEB calculation; both absolute energy and relative energy are given. This file is output every **neboutfreq* steps of the NEB optimization.</li>
<li><b>input_YYYY.xyz</b>: These files contain the reaction paths generated after new graph-moves have been performed. The files are labelled with numbers <em>YYYY</em>, indicating the structure sequence number. These files are in standard XYZ format. They can be visualized in <em>VMD</em> or <em>Avogadro</em>. <b>Important: Each of these XYZ files can be used as an input <em>pathfile</em> to a further CINEB calculation.</b></li>
<li><b>input.ChemReacList.info</b>: This file is a database which contains useful information about all of the reaction-paths generated during the GDS run. It contains information such as the chemical identities of molecules involved in the reaction, the type of the reaction performed, and the SPRINT coordinate for the reactant and product molecules.</li>
</ul>
<p>In addition to the above ouptut files, the *.log file produced by all CDE calculations will also contain some useful information about the NEB run.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Next steps</h2>
<ul>
<li>Each of the XYZ files generated by GDS could, in principle, be used as the starting-point of a CINEB refinement calculation. Ultimately, this would enable reaction rate calculation for each GDS-sampled reaction-path, leading to creating of a "rate library" for input into a kinetic model. This kinetic model could then be simulated using Kinetic Monte Carlo to predict experimental observables such as rate laws.</li>
<li>Kinetic Monte Carlo code is available in the group but is not yet explicitly linked to GDS. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
