<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CDE: Tutorial 3: Reaction path-finding</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CDE
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Chemistry Discovery Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pathfind.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tutorial 3: Reaction path-finding </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This section gives example input files and instructions for a typical double-ended reaction path-finding calculation run through CDE.</p>
<p>This calculation will perform a simulated annealing (SA) optimization of the mechanism error-function, seeking out a reaction mechanism which connects the reactant graph (as calculated from the input reactant xyz file) to the product graph (as determined from the input product xyz file).</p>
<p><b>Important: Note that the target reactant and prosuct graphs are calculated directly from the input reactant and product structures. So, make sure that the bond-lengths in your reactants and products are correct so that the calculated connectivity matrices are also correct!</b></p>
<p>The allowed moves (i.e. chemical reactions) which are used in the search for a mechanism connecting the reactant and product are provided in the move file.</p>
<p>In this example, we're going to look at the oxidation of carbon monoxide to carbon dioxide, occuring on a platinum cluster.</p>
<p><b>The actual files to run this example can be found in the *~/cde/examples/Tutorial_5/* directory.</b></p>
<p>In this directory, you will find several input files: </p><pre class="fragment">input
start.xyz
end.xyz
moves.in
</pre><p>All of these input filenames are arbitrary; we could have called them alice, bob, clive and ralph and the program would still read them in correctly. Note that the extensions have no effect for input files read in by CDE, but they can be used to remind you what the different input files are.</p>
<p>Let's have a look at each input file individually:</p>
<h2><a class="anchor" id="autotoc_md31"></a>
input</h2>
<p>The <em>input</em> file for this GDS run looks like this:</p>
<pre class="fragment"># Test input file

optaftermove .true.
calctype pathfind
nimage 10
startfile start.xyz
endfile end.xyz
ranseed 1

# path optimization
projforcetype 3
nebmethod quickmin
nebiter 1000
cithresh 1d-4
nebspring 0.1
nebstep  10.0
neboutfreq 5
nebconv 1d-4

# constraints
dofconstraints 0
atomconstraints 7
1 2 3 4 5 6 7

# PES input
pestype  lammps
pesfile   lmp.head
pesopttype  lammps
pesoptfile lmp.min
pesexecutable '/Users/scott/code/lammps-22Aug18/src/lmp_serial'
pesoptexecutable '/Users/scott/code/lammps-22Aug18/src/lmp_serial'

# Graph-driven sampling (GDS) control.
movefile moves.in
gdsthresh 0.5
gdsspring 0.02
gdsrestspring 0.05
nbstrength 0.03
nbrange 2.2
kradius 0.05
ngdsiter 500
ngdsrelax 7000
gdsdtrelax 0.15

# Chemical constraints.
valencerange{
Pt 2 12
O 1 2
C 1 4
}

reactiveatomtypes{
Pt
C
O
}

reactiveatoms{
all
}

reactivevalence{
}

fixedbonds{
Pt Pt
}

allowedbonds{
}

# Pathfinder calculation setup parameters.
nrxn 10
nmcrxn 1000000
mcrxntemp 1000000.0
nmechmove 1
graphfunctype 2
</pre><p>The input file in this case only contains (mostly) those options which are relevant to the pathfinder simulation; other input directives have been removed and will be ignored internally in CDE.</p>
<p>The parameter input blocks in the input file have already been covered in other tutorials for GDS and for CINEB (see, for example, <a class="el" href="_annotated.html">Annotated input file description</a>). In the case of a pathfinding calculation, the following are the new parameters which have an impact on the algorithm:</p>
<ul>
<li><b>calctype</b>: Note that the <em>calctype</em> parameter must be set to <em>pathfind</em>.</li>
<li><b>nrxn</b>: This is the total number of reactions used in the reaction mechanisms being searched and generated. Note that a "null" reaction is automatically included as a possible graph-move (reaction) during the simulated-annealing search, so <em>nrxn</em> is the maximum number of active chemical reactions used in each proposed reaction mechanism.</li>
<li><b>nmcrxn</b>: This is the total number of simulated annealing iterations to search for; if a reaction is not found within this number of steps, the simulation simply stops without producing final structures.</li>
<li><b>mcrxntemp</b>: This is the <em>initial</em> temperature for the simulated-annealing search; note that this temperature is linearly-scaled to zero over the course of the <em>nmcrxn</em> iterations to drive the system to local minima with lower error functions. The actual initial temperature must be chosen to suit the graphfunctype (see below).</li>
<li><b>nmechmove</b>: This integer identifies how many of the reactions the simulated-annealing algorithm should attempt to change in <em>each</em> iteration. We haven't yet systematically investigated the impact of this number; 1 or 2 seems like sensible values.</li>
<li><b>graphfunctype</b>: This integer (0, 1, 2 or 3) defines the function-type which is optimized during the SA run. All of the graph-functions are zero when one has found a mechanisms which connects the reactants and products in <em>nrxn</em> steps or less. The difference arises due to the treatment of permutational invariance, as follows:</li>
</ul>
<ol type="1">
<li><em>graphfunctype 0</em> does not consider permutational invariance. The reactant and product structures must match in their atomic ordering, and one must also make a choice of which reactant atom ends up in which position in the prodoct structure. This is obviously not that useful for automatic reaction discovery.</li>
<li><em>graphfunctype 1</em> accounts for permutational invariance by calculating a graph-error function based on eigenvalues of a matrix defined as \(M_{ij} = (m_{i} m_{j})/d_{ij}\), where \(m_{i}\) is the atomic mass of atom i and \(d_{ij}\) is the shortest distance between any two atoms calculated in terms of bond connections.</li>
<li><em>graphfunctype 2</em> accounts for permutational invariance by calculating a valence histogram for each pair of element types.</li>
<li><em>graphfunctype 3</em> accounts for permutational invariance by calculating a graph-error function based on eigenvalues of a matrix which is identical to the connectivity matrix except with the atomic masses on the diagonal elements.</li>
</ol>
<p>In the calculation setup for this example, we're allowing a maximum of 10 active reactions in the proposed reaction mechanisms, we're running for a maximum of 1000000 iterations, and we're starting at a temperature of 1,000,000 K. Note that this is not a "real" temperature, but is instead related to the graph error function type.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
start.xyz and end.xyz</h2>
<p>The <em>start.xyz</em> and <em>end.xyz</em> files are standard XYZ format files (Cartesian coordinates in Angstroms).</p>
<p>In a reaction pathfinding simulation, <em>start.xyz</em> contains the coordinates of the <b>reactant</b> structure and <em>end.xyz</em> contains the coordinates of the <b>product</b> structure. These initial stuctures are used to calculate the reactant connectivity matrix and the target (product) connectivity matrix.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
moves.in</h2>
<p>The moves.in file describes the allowed chemical reaction classes which are allowed to take place; these allowed moves are applied to configurations during a pathfinding calculation in order to generate new reaction end-points.</p>
<p>The format of the move-file is discussed in <a class="el" href="moves.html">Movefile example</a>.</p>
<h2><a class="anchor" id="autotoc_md34"></a>
Running the calculation</h2>
<p>With these input files, we are now able to run the pathfinding calculation. To do so, go into the *~/cde/examples/pathfind/* directory and type: </p><pre class="fragment">cde.x input
</pre><p>As in the other tutorials, the above assumes that you have already made sure that CDE can be run by simply typing <em>cde.x</em>. See the <a class="el" href="setup.html">setup section</a> for more details.</p>
<p>As the calculation runs, you will find lots of output files generated in the run directory.</p>
<p>The interesting output files are as follows:</p>
<ul>
<li><b>mcopt.dat</b>: This file contains a running value of the total graph-error function as a function of the number of simulated annealing iterations.</li>
<li><b>input.log</b>: Once the simulated annealing calculation is complete, the <em>log</em> file will contain lots of useful information about the final reaction mechanism (if successful).</li>
<li><b>final_path.xyz</b>: Contains an <em>xyz</em> file with molecular snapshots of the intermediates generated along the final reaction-path.</li>
<li><b>final_path_rx_ZZZ.xyz</b>: Contains an approximation to the reaction-path for reaction-step <em>ZZZ</em> in the final mechanism.</li>
</ul>
<p>The <em>xyz</em> files can obviously be plotted in VMD in order to visualize the reaction.</p>
<h2><a class="anchor" id="autotoc_md35"></a>
Optimizing structures</h2>
<p>If one sets the input parameter </p><pre class="fragment">    optaftermove .true.
</pre><p>then this means that each of the intemediate structures generated in the <em>final</em> reaction mechanism will be optimized, using the <em>pesopttype</em> and defined in the input file. In addition, the energy of each intermediate, as calculated according to <em>pestype</em>, will also be output to the <em>log</em> file.</p>
<p>Using <em>optaftermove .true.</em> is advised if one is intending to perform further calculations on the final reaction mechanism, such as NEB calculations for each reaction-path file (<em>final_path_rx_ZZZ.xyz</em>). In this case, the initial reaction-paths created for each reaction are generated such that they connect the optimized geomtries.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Final output and next steps.</h2>
<ul>
<li>Each of the reaction-path files ((<em>final_path_rx_ZZZ.xyz</em>) generated by a pathfinding could, in principle, be used as the starting-point of a CINEB refinement calculation.</li>
<li>By comparing CINEB calculations for a number of different pathfinding simulation outputs, it should also be possible to identify the "most likely" reaction mechanism (for example, with most favourable thermodynamic and kinetic properties). </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
